<div ng-controller="SearchController">
  <div class="row search-header" ng-hide="hasSearched()">
    <div class="col-md-10 col-md-offset-1 text-center">
      <h1><strong>CHPL:</strong> The Authoritative Listing of Certified Health Information Products</h1>
      <p>Welcome to the Office of the National Coordinator for Health IT's (ONC) Certified Health IT Product List (CHPL). Here, you will find the comprehensive and authoritative listing of all Health Information Technology products which have been successfully tested and certified through the ONC Health IT certification program. All products listed on the CHPL have been successfully tested by an Accredited Testing Laboratory (ATL) and successfully certified by an ONC-Authorized Certification Body (ACB) to meet criteria adopted by the Secretary of Health and Human Services.</p>
    </div>
  </div> <!-- search introduction 'header' -->

  <div class="row search-inputs">
  <form class="form-horizontal" role="search"> <!-- simple search -->
    <div class="row">
      <div class="col-xs-12">
        <div class="form-group form-group-lg">
          <div class="col-sm-1">
            <label for="searchField" class="control-label sr-only">Search</label>
          </div>
          <div class="col-sm-7">
            <div class="input-group">
              <div class="input-group-addon"><i class="fa fa-search"></i></div>
              <input type="text" class="form-control" id="searchField" placeholder="Search Certified Products and Vendors" ng-model="query.searchTermObject"
                     typeahead="element as element.value + ' (' + element.type + ')' for element in lookaheadSource.all | filter:{value:$viewValue} | limitTo:16"
                     typeahead-input-formatter="$model.value" />
            </div>
          </div>
          <div class="col-sm-2">
            <button id="searchButton" type="button" class="btn btn-default btn-lg form-control" ng-click="search()">Search</button>
          </div>
          <div class="col-sm-2">
            <a href="" ng-if="query.simple" ng-click="query.simple = !query.simple">Advanced search</a>
            <a href="" ng-if="!query.simple" ng-click="query.simple = !query.simple">Simple search</a>
            <span ng-show="hasSearched()"><br /><a href="" ng-click="clear()">Clear results</a></span>
            <br /><a href="" ng-click="browseAll()">Browse all</a>
          </div>
        </div>
      </div>
    </div> <!-- simple search row -->

    <div class="row" ng-show="!query.simple"> <!-- advanced search -->
      <div class="col-xs-12">
          <div class="form-group form-group-sm">
            <div class="col-sm-1">
              <label for="vendorField" class="control-label">Vendor</label>
            </div>
            <div class="col-sm-4">
              <div class="input-group">
                <div class="input-group-addon"><i class="fa fa-search"></i></div>
                <input type="text" class="form-control" id="vendorField" placeholder="Vendor" ng-model="query.vendorObject"
                       typeahead="element as element.value + ' (' + element.type + ')' for element in lookaheadSource.vendors | filter:{value:$viewValue} | limitTo:16"
                       typeahead-input-formatter="$model.value" />
              </div>
            </div>
            <div class="col-sm-1">
              <label for="productField" class="control-label">Product</label>
            </div>
            <div class="col-sm-4">
              <div class="input-group">
                <div class="input-group-addon"><i class="fa fa-search"></i></div>
                <input type="text" class="form-control" id="productField" placeholder="Product" ng-model="query.productObject"
                       typeahead="element as element.value + ' (' + element.type + ')' for element in lookaheadSource.products | filter:{value:$viewValue} | limitTo:16"
                       typeahead-input-formatter="$model.value" />
              </div>
            </div>
            <div class="col-sm-1">
              <label for="visibleField" class="control-label">Visible on CHPL</label>
            </div>
            <div class="col-sm-1">
              <select id="visibleField" ng-model="query.visibleOnCHPL" class="input-sm form-control">
                <option value="yes">Yes</option>
                <option value="no">No</option>
                <option value="both">Both</option>
              </select>
            </div>
          </div> <!-- first row of advanced search -->

          <div class="form-group form-group-sm">
            <div class="col-sm-1">
              <label for="versionField" class="control-label">Version</label>
            </div>
            <div class="col-sm-3">
              <div class="input-group">
                <div class="input-group-addon"><i class="fa fa-search"></i></div>
                <input type="text" class="form-control" id="versionField" placeholder="Version" ng-model="query.version" />
              </div>
            </div>
            <div class="col-sm-1">
              <label for="certField" class="control-label">Certification Criteria</label>
            </div>
            <div class="col-sm-3">
              <select id="certField" ng-model="query.certificationCriteria" multiple class="input-sm form-control">
                <option ng-repeat="cert in certs" value="{{ cert }}">{{ cert + ': ' + cert }}</option>
              </select>
            </div>
            <div class="col-sm-1">
              <label for="cqmField" class="control-label">Clinical Quality Measurements</label>
            </div>
            <div class="col-sm-3">
              <select id="cqmField" ng-model="query.cqms" multiple class="input-sm form-control">
                <option ng-repeat="cqm in cqms" value="{{ cqm }}">{{ cqm + ': ' + cqm }}</option>
              </select>
            </div>
          </div> <!-- second row of advanced -->

          <div class="form-group form-group-sm">
            <div class="col-sm-1">
              <label for="editionField" class="control-label">Certification Edition</label>
            </div>
            <div class="col-sm-3">
              <select id="editionField" ng-model="query.certificationEdition" class="input-sm form-control"
                      ng-options="edition as edition for edition in editions | orderBy:'toString()'">
              </select>
            </div>
            <div class="col-sm-1">
              <label for="classificationField" class="control-label">Product Classification</label>
            </div>
            <div class="col-sm-3">
              <select id="classificationField" ng-model="query.productClassification" class="input-sm form-control"
                      ng-options="c as c for c in classifications | orderBy:'toString()'">
              </select>
            </div>
            <div class="col-sm-1">
              <label for="practiceField" class="control-label">Practice Type</label>
            </div>
            <div class="col-sm-3">
              <select id="practiceField" ng-model="query.practiceType" class="input-sm form-control"
                      ng-options="p as p for p in practices | orderBy:'toString()'">
              </select>
            </div>
          </div> <!-- third row of advanced search -->

      </div>
    </div> <!-- advanced search row -->
  </form>
  </div>

  <div id="resultsSection" ng-show="hasSearched()">
    <div class="row">
      <div class="col-md-12">
        <h2>Results</h2>
        <p ng-hide="hasResults()">No results found</p>
        <p ng-show="hasResults()">There are {{ resultCount }} results that match your search.</p>
      </div>
    </div>
    <div ng-show="hasResults()" class="row">
      <div ng-show="visibleFilter" class="col-md-4">
        <h3>Filter</h3>
        <a href="" ng-click="clearFilter()" class="pull-right">Clear Filter</a>

        <label for="vendor-search">Filter on Vendor</label>
        <input id="vendor-search" placeholder="filter on vendor" class="input-sm form-control" type="search" ng-model="query.vendor"/>
        <label for="product-search">Filter on Product</label>
        <input id="product-search" placeholder="filter on product" class="input-sm form-control" type="search" ng-model="query.product"/>

        <label for="edition-search">Filter on Edition</label>
        <select id="edition-search" class="input-sm form-control" ng-model="query.certificationEdition"
                ng-options="e as e for e in editions | orderBy:'toString()'">
        </select>

        <label for="classification-search">Filter on Classification</label>
        <select id="classification-search" class="input-sm form-control" ng-model="query.productClassification"
                ng-options="c as c for c in classifications | orderBy:'toString()'">
        </select>

        <label for="practiceType-search">Filter on Practice Type</label>
        <select id="practiceType-search" class="input-sm form-control" ng-model="query.practiceType"
                ng-options="p as p for p in practices | orderBy:'toString()'">
        </select>

        <label for="certBody-search">Filter on Certification Body</label>
        <select id="certBody-search" class="input-sm form-control" ng-model="query.certificationBody"
                ng-options="cb as cb for cb in certBodies | orderBy:'toString()'">
        </select>

        <div>
          <button class="btn btn-default btn-block" href="" ng-click="doFilter()">Filter results</button>
        </div>

        <div ng-if="false">
          <h3>Filter on Certifications and CQMs</h3>
          <div class="panel panel-default">
            <div class="panel-body">
              <div ng-repeat="category in certsNcqms">
                <label class="filter-category" ng-click="showCategory = !showCategory">
                  <i class="fa fa-chevron-right" ng-class="{'fa-rotate-90' : showCategory}"></i>
                  {{ category.title }}
                </label>
                <br />
                <span ng-class="{'hidden' : !showCategory}" ng-repeat="cert in category.certs">
                  <input type="checkbox" ng-model="certFilter[cert.number]" ng-change="toggleCertFilter(category.title, cert.title, cert.number); certsChanged()" id="certFilter{{ cert.number }}" />
                  <label for="certFilter{{ cert.number }}">{{ cert.number + ": " + cert.title }}</label>
                  <br />
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div ng-class="visibleFilter ? 'col-md-8' : 'col-md-12'">
        <span class="search-activate-filter" ng-click="visibleFilter = !visibleFilter"><i class="fa fa-2x fa-angle-double-right" ng-class="{ 'fa-flip-horizontal' : visibleFilter }"></i>
          {{ visibleFilter ? 'Hide' : 'Show'}}  Filter
        </span>
        <table class="table table-striped">
          <thead>
            <tr>
              <th class="search-header" ng-click="sort('vendor')"
                  ng-class="{'sort-ascent': query.orderBy==='vendor' && !query.sortDescending, 'sort-descent': query.orderBy==='vendor' && query.sortDescending}">Vendor</th>
		      <th class="search-header" ng-click="sort('product')"
                  ng-class="{'sort-ascent': query.orderBy==='product' && !query.sortDescending, 'sort-descent': query.orderBy==='product' && query.sortDescending}">Product</th>
              <th class="">Version</th>
		      <th class="">Certs & CQMs</th>
              <th class="search-header" ng-click="sort('certificationDate')"
                  ng-class="{'sort-ascent': query.orderBy==='certificationDate' && !query.sortDescending, 'sort-descent': query.orderBy==='certificationDate' && query.sortDescending}">Certification Date</th>
              <th><a href="" ng-click="compare()">Compare</a></th>
	        </tr>
	      </thead>
	      <tbody>
	        <tr ng-repeat-start="row in displayedResults">
		      <td class="productHeader" ng-click="showDetails = !showDetails">{{ row.vendor.name }}</td>
		      <td class="productHeader" ng-click="showDetails = !showDetails">{{ row.product.name }}</td>
		      <td class="productHeader" ng-click="showDetails = !showDetails">{{ row.product.version }}</td>
		      <td class="productHeader" ng-click="showDetails = !showDetails">{{ row.countCerts }} Certifications / {{ row.countCqms }} CQMs</td>
		      <td class="productHeader" ng-click="showDetails = !showDetails">{{ row.certificationDate.split(' ')[0] | date }}</td>
              <td align="center">
                <input type="checkbox" ng-click="toggleCompareId(row.id)" ng-model="compareBoxes[row.id]" id="compareBoxes{{ row.id }}"/>
                <label class="sr-only" for="compareBoxes{{ row.id }}">Select to compare</label>
                <span class="sr-only"><a href="" ng-click="showDetails = !showDetails">Show Details</a></span>
              </td>
	        </tr>
            <tr ng-repeat-end class="productDetails" ng-class="{ 'hidden': !showDetails}">
              <td colspan="6">
                <table class="table" width="100%">
                  <thead>
                    <tr>
                      <th>Practice Type</th>
                      <th>Classification</th>
                      <th>Certifying Body</th>
                      <th>Certification Edition</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>{{ row.practiceType.name }}</td>
                      <td>{{ row.classificationType.name }}</td>
                      <td>{{ row.certifyingBody.name }}</td>
                      <td>{{ row.certificationEdition.name }}</td>
                      <td><a href="#/product/{{ row.id }}">details</a></td>
                    </tr>
                  </tbody>
                </table>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
	          <td colspan="6" class="text-center">
                <pagination total-items="resultCount" ng-model="visiblePage" items-per-page="query.pageSize" ng-change="pageChanged()"
                            max-size="10" class="pagination-sm" boundary-links="true"></pagination>
	          </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div> <!-- end of search results -->

  <div class="row" ng-hide="hasSearched()">
    <div class="col-md-6">
      <h2>How the CHPL works</h2>
      <p>Pellentesque dapibus suscipit ligula.  Donec posuere augue in quam.  Etiam vel tortor sodales tellus ultricies commodo.  Suspendisse potenti.  Aenean in sem ac leo mollis blandit.  Donec neque quam, dignissim in, mollis nec, sagittis eu, wisi.  Phasellus lacus.  Etiam laoreet quam sed arcu.  Phasellus at dui in ligula mollis ultricies.  Integer placerat tristique nisl.  Praesent augue.  Fusce commodo.  Vestibulum convallis, lorem a tempus semper, dui dui euismod elit, vitae placerat urna tortor vitae lacus.  Nullam libero mauris, consequat quis, varius et, dictum id, arcu.  Mauris mollis tincidunt felis.  Aliquam feugiat tellus ut neque.  Nulla facilisis, risus a rhoncus fermentum, tellus tellus lacinia purus, et dictum nunc justo sit amet elit.</p>
    </div>
    <div class="col-sm-6">
      <img src="lib/infographic.png" width="300" height="200" alt="Infographic describing how the CHPL works"></img>
    </div>
  </div> <!-- end of other infographic -->

  <div ng-hide="hasSearched()">
    <div class="row">
      <div class="col-md-12">
        <h2>Other Agencies</h2>
      </div>
    </div>
    <div class="row">
      <div class="col-md-3 col-sm-6">
        <img src="" width="100px" height="100px" alt="Other agency 1" />
        <a href="#">Other agency 1</a>
      </div>
      <div class="col-md-3 col-sm-6">
        <img src="" width="100px" height="100px" alt="Other agency 2" />
        <a href="#">Other agency 2</a>
      </div>
      <div class="col-md-3 col-sm-6">
        <img src="" width="100px" height="100px" alt="Other agency 3" />
        <a href="#">Other agency 3</a>
      </div>
      <div class="col-md-3 col-sm-6">
        <img src="" width="100px" height="100px" alt="Other agency 4" />
        <a href="#">Other agency 4</a>
      </div>
    </div>
  </div> <!-- end of other agencies -->

</div> <!-- end controller -->
