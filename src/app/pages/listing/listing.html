<div class="container" ng-if="!$ctrl.loading">
  <div class="row text-bottom" ng-if="$ctrl.product">
    <div class="col-sm-8">
      <h1 id="listing-name">{{ $ctrl.product.product.name }}</h1>
    </div>
    <div class="col-sm-4 text-right">
      <p><a href="#/search"><i class="fa fa-arrow-left fa-lg"></i> Return to search results</a></p>
    </div>
  </div>
  <div class="main-content" id="main-content" tabindex="-1">
    <p class="lead" ng-if="!$ctrl.product">This listing does not exist. Search the CHPL on <a href="#/search">the search page</a></p>
    <div ng-if="$ctrl.product">
      <div class="row">
        <div class="col-sm-4">
          <p>CHPL Product Number: {{ $ctrl.product.chplProductNumber }}</p>
          <p ng-if="$ctrl.product.acbCertificationId">ONC-ACB Certification ID: {{ $ctrl.product.acbCertificationId }}</p>
        </div>
        <div class="col-sm-8 text-right">
          <p>Certification Date: {{ $ctrl.product.certificationDate | date : 'mediumDate' : 'UTC' }} | Last modified Date: {{ $ctrl.product.lastModifiedDate | date : 'mediumDate' : 'UTC' }} <button ng-if="$ctrl.activity && $ctrl.activity.length > 0" class="btn btn-default btn-sm" ng-click="$ctrl.viewProductHistory($ctrl.product.id)" id="view-product-history"><i class="fa fa-eye"></i><span class="sr-only">View Details</span></button></p>
          <p ng-if="$ctrl.hasAnyRole(['ROLE_ADMIN', 'ROLE_ACB', 'ROLE_ONC'])"><a ng-href="#/admin/dpManagement/manage/{{ $ctrl.product.id}}"><i class="fa fa-pencil-square-o"></i> Edit Certified Product</a></p>
          <p ng-if="$ctrl.hasAnyRole(['ROLE_ADMIN', 'ROLE_ACB', 'ROLE_ONC'])"><a ng-href="#/admin/dpManagement/manageSurveillance/{{ $ctrl.product.id}}"><i class="fa fa-pencil-square-o"></i> Manage Surveillance Activity</a></p>
          <div class="btn-group">
            <div class="btn-group" ng-if="$ctrl.certificationStatus($ctrl.product) !== 'Retired'">
              <ai-cms-widget-button product-id="{{ $ctrl.product.id }}" product-name="{{ $ctrl.product.product.name }}"></ai-cms-widget-button>
            </div>
            <div class="btn-group">
              <ai-compare-widget-button product-id="{{ $ctrl.product.id }}" product-name="{{ $ctrl.product.product.name }}"></ai-compare-widget-button>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-4" id="product-information-basic">
          <div class="product-element" id="product-information-developer">
            <chpl-developer developer="$ctrl.product.developer"
                            can-edit="$ctrl.hasAnyRole(['ROLE_ADMIN', 'ROLE_ONC', 'ROLE_ACB'])"
                            can-merge="$ctrl.hasAnyRole(['ROLE_ADMIN', 'ROLE_ONC'])"
                            can-split="$ctrl.hasAnyRole(['ROLE_ADMIN', 'ROLE_ONC', 'ROLE_ACB'])"
                            take-action="$ctrl.takeDeveloperAction(developerId, action)"
                            ></chpl-developer>
          </div>
          <div class="product-element" id="product-information-product-history">
            <span ng-if="$ctrl.product.product.ownerHistory && $ctrl.product.product.ownerHistory.length > 0">
              <h3>Previous Developer<span ng-if="$ctrl.product.product.ownerHistory.length > 1">s</span></h3>
              <ul>
                <li ng-repeat="prev in $ctrl.product.product.ownerHistory | orderBy:'transferDate'">
                  <strong>{{ prev.developer.name }}</strong><br />
                  Transfer Date: {{ prev.transferDate | date : 'mediumDate' : 'UTC' }}
                </li>
              </ul>
            </span>
          </div>
          <div class="product-element" id="product-information-version">
            <h2 class="product-heading">Version</h2>
            <p>{{ $ctrl.product.version.version }}</p>
          </div>
          <div class="product-element" id="product-information-certification-edition">
            <h2 class="product-heading">Certification Edition</h2>
            <p>{{ $ctrl.product.certificationEdition.name }}</p>
          </div>
          <div class="product-element" id="product-information-certification-status">
            <h2 class="product-heading">Certification Status</h2>
            <p>{{ $ctrl.certificationStatus($ctrl.product) }}</p>
          </div>
          <div class="product-element" ng-if="$ctrl.product.certificationEdition.name === '2014'" id="product-information-practice-type">
            <h2 class="product-heading">Practice Type</h2>
            <p>{{ $ctrl.product.practiceType.name }}</p>
          </div>
          <div class="product-element" ng-if="$ctrl.product.certificationEdition.name === '2014'" id="product-information-classification-type">
            <h2 class="product-heading">Classification Type</h2>
            <p>{{ $ctrl.product.classificationType.name }}</p>
          </div>
          <div class="product-element" id="product-information-onc-authorized-certification-body">
            <h2 class="product-heading">ONC-Authorized Certification Body</h2>
            <p>{{ $ctrl.product.certifyingBody.name }}</p>
          </div>
          <div class="product-element" ng-if="$ctrl.product.testingLabs && $ctrl.product.testingLabs.length !== 0" id="product-information-onc-accredited-testing-laboratory">
            <h2 class="product-heading">ONC-Accredited Testing Laborator{{ $ctrl.product.testingLabs.length === 1 ? 'y' : 'ies' }}</h2>
            <p ng-repeat="atl in $ctrl.product.testingLabs | orderBy:'toString'">{{ atl.testingLabName }}</p>
          </div>
          <div class="product-element" ng-if="$ctrl.product.productAdditionalSoftware" id="product-information-relied-upon-software">
            <h2 class="product-heading">Relied Upon Software</h2>
            <p>{{ $ctrl.product.productAdditionalSoftware }}</p>
          </div>
          <span ng-if="$ctrl.product.transparencyAttestation">
            <div class="product-element" id="product-information-transparency-attestation">
              <h2 class="product-heading">Transparency Attestation</h2>
              <p>{{ $ctrl.product.transparencyAttestation }}</p>
            </div>
            <div class="product-element" id="product-information-mandatory-disclosures-url">
              <h2 class="product-heading">Mandatory Disclosures URL</h2>
              <a ai-a ng-if="$ctrl.product.transparencyAttestationUrl" href="{{ $ctrl.product.transparencyAttestationUrl }}" analytics-on="click" analytics-event="Transparency Disclosure" analytics-properties="{ category: 'Download Details', label: $ctrl.product.transparencyAttestationUrl }">{{ $ctrl.product.transparencyAttestationUrl }}</a>
              <p ng-if="!$ctrl.product.transparencyAttestationUrl">No report on file</p>
            </div>
          </span>
        </div>
        <div class="col-sm-8" id="product-information-details">
          <ai-certs initial-panel="{{ $ctrl.initialPanel }}"
                    product="$ctrl.product">
          </ai-certs>
        </div>
      </div>
    </div>
  </div>
</div>
