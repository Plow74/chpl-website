<div st-table="$ctrl.displayed" st-safe-src="$ctrl.results">
  <div class="row">
      <div class="col-sm-12">
      <h3>Developer</h3>
      </div>
  </div>
  <div class="row">
      <label for="activity-start-upload" class="col-sm-2 control-label">Start Date</label>
      <div class="col-sm-3">
      <input type="date" class="form-control" ng-model="$ctrl.activityRange.startDate" name="activityStartUpload" id="activity-start-upload" placeholder="yyyy-MM-dd">
      </div>
      <label for="activity-end-upload" class="col-sm-2 control-label">End Date</label>
      <div class="col-sm-3">
      <input type="date" class="form-control" ng-model="$ctrl.activityRange.endDate" name="activityEndUpload" id="activity-end-upload" placeholder="yyyy-MM-dd">
      </div>
      <div class="col-sm-2">
      <button class="btn btn-primary btn-block" ng-click="$ctrl.search()" ng-disabled="!$ctrl.validDates()"><i class="fa fa-search"></i> Search</button>
      <button class="btn btn-ai-success btn-block" ng-click="$ctrl.prepareDownload()" ng-if="!$ctrl.downloadReady()"><i class="fa fa-bolt"></i> Prepare download</button>
      <button class="btn btn-ai-success btn-block" ng-if="$ctrl.downloadReady()"
              ng-csv="$ctrl.displayed" filename="Certified_Products_{{ $ctrl.filename }}"
              csv-header="['ACB', 'Developer', 'Product', 'Certification Edition', 'CHPL Product Number', 'Certification Date', 'Activity', 'Activity Date']"
              csv-column-order="['acbName', 'developerName', 'productName', 'edition', 'chplProductNumber', 'friendlyCertificationDate', 'csvDetails', 'friendlyActivityDate']">
          <i class="fa fa-cloud-download"></i> Download</button>
      </div>
  </div>
  <div class="row">
      <div class="col-sm-12 text-danger" ng-if="!$ctrl.validDates()">Start date must be before end date, and no more than {{ $ctrl.activityRange.range }} days apart</div>
  </div>
  <!--
  <div class="row">
      <div class="col-sm-12">
      <input st-search="filterText" placeholder="Filter on Developer, Product, or CHPL Product Number" class="input-sm form-control" type="search">
      <label class="control-label">Activity ({{ $ctrl.displayed.length }})
          <select st-search="categoriesFilter" class="form-control">
          <option value="|LISTING|" selected>All</option>
          <option value="|SURVEILLANCE|">Surveillance</option>
          <option value="|LISTING_UPLOAD|">Upload</option>
          <option value="|LISTING_STATUS_CHANGE|">Status Change</option>
          </select>
      </label>
      </div>
  </div>
-->
  <table st-table="$ctrl.displayedDevelopers" st-safe-src="$ctrl.searchedDevelopers" class="table table-responsize">
    <thead>
      <tr>
        <th class="search-header" st-sort="developer" st-skip-natural="true">Developer</th>
        <th class="search-header" st-sort="developerCode" st-skip-natural="true">Developer Code</th>
        <th class="search-header" st-sort="responsibleUser" st-skip-natural="true">Responsible User</th>
        <th class="search-header" st-sort="date" st-skip-natural="true" st-sort-default="reverse">Activity Date</th>
      </tr>
      <!--
      <tr>
        <th><input st-search="developer" placeholder="Filter Developer" class="input-sm form-control" type="search"></th>
        <th><input st-search="developerCode" placeholder="Filter Developer Code" class="input-sm form-control" type="search"></th>
        <th><input st-search="responsibleUser" placeholder="Filter Responsible User" class="input-sm form-control" type="search"></th>
        <th>&nbsp;</th>
        <th>&nbsp;</th>
      </tr>
    -->
    </thead>
    <!--
    <tfoot>
      <tr>
        <td colspan="5">
          <a type="button" class="btn btn-lg btn-ai-success"
              ng-csv="$ctrl.displayedDevelopers" filename="Developers_{{ $ctrl.filename }}"
              csv-header="['Developer', 'Developer Code', 'Resonsible User'
              , 'Activity', 'Details', 'Activity Date']"
              csv-column-order="['developer', 'developerCode', 'responsibleUser', 'csvAction', 'csvDetails', 'friendlyActivityDate']">
            <i class="fa fa-cloud-download"></i> Download
          </a>
        </td>
      </tr>
    </tfoot>
  -->
    <tbody>
      <tr ng-if="$ctrl.displayed.length === 0">
        <td colspan="5">No activity found</td>
      </tr>
      <tr ng-repeat="activity in $ctrl.displayed">
        <td>{{ activity.developerName }}</td>
        <td>{{ activity.developerCode }}</td>
        <td>{{ activity.responsibleUser.fullName }}</td>
        <td>{{ activity.date | date : 'MMM d, y H:mm:ss Z' : 'UTC' }}</td>
        <td>
          <button class="btn btn-link pull-right" ng-if="!activity.action && !activity.showDetails" ng-click="$ctrl.parse(activity); activity.showDetails = true">Details</button>
          <button class="btn btn-link pull-right" ng-if="activity.action && !activity.showDetails" ng-click="activity.showDetails = true">Details</button>
          <button class="btn btn-link pull-right" ng-if="activity.action && activity.showDetails" ng-click="activity.showDetails = false">Hide Details</button>
          <button class="btn btn-link pull-right" ng-if="!activity.action && activity.showDetails" disabled><i class="fa fa-spin fa-spinner"></i> Processing</button>
          <div ng-if="activity.action && activity.showDetails">
            {{ activity.action }}
            <ul>
              <li ng-repeat="str in activity.details | orderBy : 'toString()' track by $index" ng-bind-html="str"></li>
            </ul>
            <button class="btn btn-sm btn-ai-success" ng-click="$ctrl.compareSurveillances(activity.source.oldS, activity.source.newS)" ng-if="activity.source"><i class="fa fa-search"></i>View Details</button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

