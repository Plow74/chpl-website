<section class="row">
  <div class="col-sm-12 admin-inner-tab main-content form-horizontal" ng-form="$ctrl.activityForm">
    <div ng-if="$ctrl.workType === 'listings' || $ctrl.workType === 'cp-upload' || ($ctrl.workType === '' && $ctrl.productId) || $ctrl.workType === 'cp-status' || $ctrl.workType === 'cp-surveillance' || $ctrl.workType === 'cp-other'">
      <chpl-reports-listings product-id="$ctrl.productId"></chpl-reports-listings>
    </div>
    <div ng-if="$ctrl.workType === 'developers'">
      <chpl-reports-developers></chpl-reports-developers>
    </div>
    <div ng-if="$ctrl.workType === 'prod'">
      <chpl-reports-products></chpl-reports-products>
    </div>
    <div ng-if="$ctrl.workType === 'versions'">
      <chpl-reports-versions></chpl-reports-versions>
    </div>
    <div ng-if="$ctrl.workType === 'acb'">
      <chpl-reports-acbs></chpl-reports-acbs>
    </div>
    <div ng-if="$ctrl.workType === 'atl'">
      <chpl-reports-atls></chpl-reports-atls>
    </div>
    <div ng-if="$ctrl.workType === 'announcement'">
      <chpl-reports-announcements></chpl-reports-announcements>
    </div>

    <div class="row" ng-if="$ctrl.workType === 'users'">
      <div class="col-sm-12">
        <h3>User Activity</h3>
        <div>
          <label for="activity-start-user-activity" class="col-sm-2 control-label">Start Date</label>
          <div class="col-sm-3">
            <input type="date" class="form-control" ng-model="$ctrl.activityRange.userActivity.startDate" name="activityStartUserActivity" id="activity-start-user-activity" placeholder="yyyy-MM-dd">
          </div>
          <label for="activity-end-user-activity" class="col-sm-2 control-label">End Date</label>
          <div class="col-sm-3">
            <input type="date" class="form-control" ng-model="$ctrl.activityRange.userActivity.endDate" name="activityEndUserActivity" id="activity-end-user-activity" placeholder="yyyy-MM-dd">
          </div>
          <div class="col-sm-2">
            <button class="btn btn-primary" ng-click="$ctrl.refreshActivity()" ng-disabled="!$ctrl.validDates('userActivity')">Search <i class="fa fa-search"></i></button>
          </div>
          <div class="col-sm-12 text-danger" ng-if="!$ctrl.validDates('userActivity')">Start date must be before end date, and no more than {{ $ctrl.activityRange.range }} days apart</div>
        </div>
        <table st-table="$ctrl.displayedUsers" st-safe-src="$ctrl.searchedUsers" class="table table-striped">
          <thead>
            <tr>
              <th>Activity</th>
              <th class="search-header" st-sort="date" st-skip-natural="true" st-sort-default="reverse">Date</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-if="$ctrl.displayedUsers.length === 0">
              <td colspan="2">No activity found</td>
            </tr>
            <tr ng-repeat="activity in $ctrl.displayedUsers" ng-if="$ctrl.displayedUsers.length > 0">
              <td><span ng-bind-html="activity.description"></span></td>
              <td>{{ activity.activityDate | date : 'MMM d, y H:mm:ss Z' : 'UTC' }}</td>
            </tr>
          </tbody>
        </table>
        <h3>User Actions</h3>
        <table st-table="$ctrl.displayedUserActivities" st-safe-src="$ctrl.searchedUserActivities" class="table">
          <thead>
            <tr>
              <th class="search-header" st-sort="user.fullName" st-skip-natural="true" st-sort-default>User</th>
              <th scope="col">Action</th>
              <th scope="col">Date</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-if="$ctrl.displayedUserActivities.length === 0">
              <td colspan="3">No activity found</td>
            </tr>
            <tr ng-repeat-start="activity in $ctrl.displayedUserActivities" ng-if="$ctrl.displayedUserActivities.length > 0">
              <td rowspan="{{ activity.events.length }}">{{ activity.user.fullName }}<br />{{ activity.user.email }}</td>
              <td>{{ activity.events[0].description }}</td>
              <td>{{ activity.events[0].activityDate | date : 'MMM d, y H:mm:ss Z' : 'UTC' }}</td>
            </tr>
            <tr ng-repeat="action in activity.events" ng-if="!$first && $ctrl.displayedUserActivities.length > 0" ng-repeat-end>
              <td>{{ action.description }}</td>
              <td>{{ action.activityDate | date : 'MMM d, y H:mm:ss Z' : 'UTC' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div ng-if="$ctrl.workType === 'api_key_management'">
      <chpl-reports-api-keys></chpl-reports-api-keys>
    </div>

    <div ng-if="$ctrl.workType === 'api_key_usage'">
      <chpl-reports-api-key-usage></chpl-reports-api-key-usage>
    </div>
  </div>
</section>
