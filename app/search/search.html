<div ng-controller="SearchController">
  <div class="row splash-row" ng-hide="hasSearched()">
    <div class="col-md-10 col-md-offset-1 text-center jumbotron">
      <h1><strong>CHPL</strong></h1>
    </div>
  </div> <!-- search introduction 'header' -->

  <div class="row search-inputs">
    <form class="form-horizontal" role="search"> <!-- simple search -->
      <div class="row">
        <div class="col-xs-12">
          <div class="form-group form-group-lg">
            <div class="col-sm-1">
              <label for="searchField" class="control-label sr-only">Search</label>
            </div>
            <div class="col-sm-7">
              <div class="input-group">
                <div class="input-group-addon"><i class="fa fa-search"></i></div>
                <input type="text" class="form-control" id="searchField" placeholder="Search Certified Products and Developers" ng-model="query.searchTermObject"
                       typeahead="element as element.value + ' (' + element.type + ')' for element in lookaheadSource.all | filter:{value:$viewValue} | limitTo:16"
                       typeahead-input-formatter="$model.value" />
              </div>
            </div>
            <div class="col-sm-2">
              <button id="searchButton" type="button" class="btn btn-default btn-lg form-control" ng-click="search()">Search</button>
            </div>
            <div class="col-sm-2">
              <a href="" ng-if="query.simple" ng-click="query.simple = !query.simple">Advanced search</a>
              <a href="" ng-if="!query.simple" ng-click="query.simple = !query.simple">Simple search</a>
              <span ng-if="hasSearched()"><br /><a href="" ng-click="clear()">Clear results</a></span>
              <br /><a href="" ng-click="browseAll()">Browse all</a>
            </div>
          </div>
        </div>
      </div> <!-- simple search row -->

      <div class="row" ng-if="!query.simple"> <!-- advanced search -->
        <div class="col-xs-12">
          <div class="form-group form-group-sm">
            <div class="col-sm-1">
              <label for="vendorField" class="control-label">Developer</label>
            </div>
            <div class="col-sm-4">
              <div class="input-group">
                <div class="input-group-addon"><i class="fa fa-search"></i></div>
                <input type="text" class="form-control" id="vendorField" placeholder="Developer" ng-model="query.vendorObject"
                       typeahead="element as element.value + ' (' + element.type + ')' for element in lookaheadSource.vendors | filter:{value:$viewValue} | limitTo:16"
                       typeahead-input-formatter="$model.value" />
              </div>
            </div>
            <div class="col-sm-1">
              <label for="productField" class="control-label">Product</label>
            </div>
            <div class="col-sm-4">
              <div class="input-group">
                <div class="input-group-addon"><i class="fa fa-search"></i></div>
                <input type="text" class="form-control" id="productField" placeholder="Product" ng-model="query.productObject"
                       typeahead="element as element.value + ' (' + element.type + ')' for element in lookaheadSource.products | filter:{value:$viewValue} | limitTo:16"
                       typeahead-input-formatter="$model.value" />
              </div>
            </div>
            <div class="col-sm-1">
              <label for="visibleField" class="control-label">Visible on CHPL</label>
            </div>
            <div class="col-sm-1">
              <select id="visibleField" ng-model="query.visibleOnCHPL" class="input-sm form-control">
                <option value="yes">Yes</option>
                <option value="no">No</option>
                <option value="both">Both</option>
              </select>
            </div>
          </div> <!-- first row of advanced search -->

          <div class="form-group form-group-sm">
            <div class="col-sm-1">
              <label for="versionField" class="control-label">Version</label>
            </div>
            <div class="col-sm-3">
              <div class="input-group">
                <div class="input-group-addon"><i class="fa fa-search"></i></div>
                <input type="text" class="form-control" id="versionField" placeholder="Version" ng-model="query.version" />
              </div>
            </div>
            <div class="col-sm-1">
              <label for="certField" class="control-label">Certification Criteria</label>
            </div>
            <div class="col-sm-3">
              <select id="certField" ng-model="query.certificationCriteria" multiple class="input-sm form-control"
                      ng-options="cert.name as cert.name + ': ' + cert.title for cert in certs | orderBy:'name'">
              </select>
            </div>
            <div class="col-sm-1">
              <label for="cqmField" class="control-label">Clinical Quality Measures</label>
            </div>
            <div class="col-sm-3">
              <select id="cqmField" ng-model="query.cqms" multiple class="input-sm form-control"
                      ng-options="cqm.name as cqm.name + ': ' + cqm.title for cqm in cqms | orderBy:'name'">
              </select>
            </div>
          </div> <!-- second row of advanced -->

          <div class="form-group form-group-sm">
            <div class="col-sm-1">
              <label for="editionField" class="control-label">Certification Edition</label>
            </div>
            <div class="col-sm-3">
              <select id="editionField" ng-model="query.certificationEdition" class="input-sm form-control"
                      ng-options="edition.name as edition.name for edition in editions | orderBy:'name'">
              </select>
            </div>
            <div class="col-sm-1">
              <label for="classificationField" class="control-label">Product Classification</label>
            </div>
            <div class="col-sm-3">
              <select id="classificationField" ng-model="query.productClassification" class="input-sm form-control"
                      ng-options="c.name as c.name for c in classifications | orderBy:'name'">
              </select>
            </div>
            <div class="col-sm-1">
              <label for="practiceField" class="control-label">Practice Type</label>
            </div>
            <div class="col-sm-3">
              <select id="practiceField" ng-model="query.practiceType" class="input-sm form-control"
                      ng-options="p.name as p.name for p in practices | orderBy:'name'">
              </select>
            </div>
          </div> <!-- third row of advanced search -->

        </div>
      </div> <!-- advanced search row -->
    </form>
  </div>

  <div id="resultsSection" ng-if="hasSearched()">
    <div class="row">
      <div class="col-md-12">
        <h2>Results</h2>
        <p ng-if="!hasResults()">No results found</p>
        <p ng-if="hasResults()">There are {{ resultCount }} results that match your search.</p>
      </div>
    </div>
    <div ng-if="hasResults()" class="row">
      <div class="col-md-12">
        <table class="table table-striped">
          <thead>
            <tr>
              <th class="search-header" ng-click="sort('vendor')"
                  ng-class="{'sort-ascent': query.orderBy==='vendor' && !query.sortDescending, 'sort-descent': query.orderBy==='vendor' && query.sortDescending}">Developer</th>
		      <th class="search-header" ng-click="sort('product')"
                  ng-class="{'sort-ascent': query.orderBy==='product' && !query.sortDescending, 'sort-descent': query.orderBy==='product' && query.sortDescending}">Product</th>
              <th class="">Version</th>
		      <th class="">Certification Criteria & Clinical Quality Measures</th>
              <th class="search-header" ng-click="sort('certificationDate')"
                  ng-class="{'sort-ascent': query.orderBy==='certificationDate' && !query.sortDescending, 'sort-descent': query.orderBy==='certificationDate' && query.sortDescending}">Certification Date</th>
              <th><button class="btn btn-default" ng-click="compare()">Compare</button></th>
	        </tr>
	      </thead>
	      <tbody>
	        <tr ng-repeat-start="row in displayedResults">
		      <td class="productHeader" ng-click="showDetails = !showDetails">{{ row.vendor.name }}</td>
		      <td class="productHeader" ng-click="showDetails = !showDetails">{{ row.product.name }}</td>
		      <td class="productHeader" ng-click="showDetails = !showDetails">{{ row.product.version }}</td>
		      <td class="productHeader" ng-click="showDetails = !showDetails">{{ row.countCerts }} Certification Criteria / {{ row.countCqms }} Clinical Quality Measures</td>
		      <td class="productHeader" ng-click="showDetails = !showDetails">{{ row.certificationDate | date }}</td>
              <td align="center">
                <input type="checkbox" ng-click="toggleCompareId(row.id)" ng-model="compareBoxes[row.id]" id="compareBoxes{{ row.id }}"/>
                <label class="sr-only" for="compareBoxes{{ row.id }}">Select to compare</label>
                <span class="sr-only"><a href="" ng-click="showDetails = !showDetails">Show Details</a></span>
              </td>
	        </tr>
            <tr ng-repeat-end class="productDetails" ng-class="{ 'hidden': !showDetails}">
              <td colspan="6">
                <table class="table" width="100%">
                  <thead>
                    <tr>
                      <th>Practice Type</th>
                      <th>Classification</th>
                      <th>Certifying Body</th>
                      <th>Certification Edition</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>{{ row.practiceType.name }}</td>
                      <td>{{ row.classificationType.name }}</td>
                      <td>{{ row.certifyingBody.name }}</td>
                      <td>{{ row.certificationEdition.name }}</td>
                      <td><a href="#/product/{{ row.id }}">details</a></td>
                    </tr>
                  </tbody>
                </table>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
	          <td colspan="6" class="text-center">
                <pagination total-items="resultCount" ng-model="visiblePage" items-per-page="query.pageSize" ng-change="pageChanged(visiblePage)"
                            max-size="10" class="pagination-sm" boundary-links="true"></pagination>
	          </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div> <!-- end of search results -->
</div> <!-- end controller -->
