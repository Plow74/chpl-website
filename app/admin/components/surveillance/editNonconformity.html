<div role="modal" aria-labeled-by="editNonconformityLabel">
  <div class="modal-header">
    <button type="button" class="close pull-right" aria-label="Cancel edits"
            confirm="Are you sure you wish to cancel editing? Your changes will not be saved."
            confirm-ok="Yes"
            confirm-cancel="No"
            confirm-settings="{animation: false, keyboard: false, backdrop: 'static'}"
            ng-click="vm.cancel()"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title" id="editSurveillanceLabel">Edit Non-Conformity</h4>
  </div>
  <div class="modal-body form-horizontal" ng-form="vm.editForm">
    <div class="form-group">
      <label for="nonconformityType" class="col-sm-3">Non-Conformity Type <span class="text-danger">*</span></label>
      <div class="col-sm-9">
        <input class="input-sm form-control" type="text" ng-model="vm.nonconformity.nonconformityType" id="nonconformityType" name="nonconformityType" required>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.nonconformityType.$touched) && vm.editForm.nonconformityType.$error.required">Field is required</div>
      </div>
    </div>
    <div class="form-group">
      <label for="nonconformityStatus" class="col-sm-3">Non-Conformity Status <span class="text-danger">*</span></label>
      <div class="col-sm-9">
        <select class="input-sm form-control" ng-model="vm.nonconformity.status" id="nonconformityStatus" name="nonconformityStatus"
                ng-options="type as type.name for type in vm.data.nonconformityStatusTypes.data | orderBy:'name'" required>
        </select>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.nonconformityStatus.$touched) && vm.editForm.nonconformityStatus.$error.required">Field is required</div>
      </div>
    </div>
    <div class="form-group">
      <label for="dateOfDetermination" class="col-sm-3">Date Of Determination <span class="text-danger">*</span></label>
      <div class="col-sm-9">
        <input class="input-sm form-control" type="date" ng-model="vm.nonconformity.dateOfDeterminationObject" id="dateOfDetermination" name="dateOfDetermination" ng-model-options="{ timezone: 'UTC' }" required>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.dateOfDetermination.$touched) && vm.editForm.dateOfDetermination.$error.required">Field is required</div>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.dateOfDetermination.$touched) && vm.editForm.dateOfDetermination.$error.date">Improper format (mm/dd/yyyy)</div>
      </div>
    </div>
    <div class="form-group">
      <label for="capApprovalDate" class="col-sm-3">Corrective Action Plan Approval Date</label>
      <div class="col-sm-9">
        <input class="input-sm form-control" type="date" ng-model="vm.nonconformity.capApprovalDateObject" id="capApprovalDate" name="capApprovalDate" ng-model-options="{ timezone: 'UTC' }"></input>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.capApprovalDate.$touched) && vm.editForm.capApprovalDate.$error.required">Field is required</div>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.capApprovalDate.$touched) && vm.editForm.capApprovalDate.$error.date">Improper format (mm/dd/yyyy)</div>
      </div>
    </div>
    <div class="form-group">
      <label for="capStartDate" class="col-sm-3">Corrective Action Plan Start Date</label>
      <div class="col-sm-9">
        <input class="input-sm form-control" type="date" ng-model="vm.nonconformity.capStartDateObject" id="capStartDate" name="capStartDate" ng-model-options="{ timezone: 'UTC' }"></input>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.capStartDate.$touched) && vm.editForm.capStartDate.$error.required">Field is required</div>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.capStartDate.$touched) && vm.editForm.capStartDate.$error.date">Improper format (mm/dd/yyyy)</div>
      </div>
    </div>
    <div class="form-group">
      <label for="capEndDate" class="col-sm-3">Corrective Action Plan End Date</label>
      <div class="col-sm-9">
        <input class="input-sm form-control" type="date" ng-model="vm.nonconformity.capEndDateObject" id="capEndDate" name="capEndDate" ng-model-options="{ timezone: 'UTC' }"></input>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.capEndDate.$touched) && vm.editForm.capEndDate.$error.required">Field is required</div>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.capEndDate.$touched) && vm.editForm.capEndDate.$error.date">Improper format (mm/dd/yyyy)</div>
      </div>
    </div>
    <div class="form-group">
      <label for="capMustCompleteDate" class="col-sm-3">Corrective Action Plan Must Complete Date</label>
      <div class="col-sm-9">
        <input class="input-sm form-control" type="date" ng-model="vm.nonconformity.capMustCompleteDateObject" id="capMustCompleteDate" name="capMustCompleteDate" ng-model-options="{ timezone: 'UTC' }"></input>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.capMustCompleteDate.$touched) && vm.editForm.capMustCompleteDate.$error.required">Field is required</div>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.capMustCompleteDate.$touched) && vm.editForm.capMustCompleteDate.$error.date">Improper format (mm/dd/yyyy)</div>
      </div>
    </div>
    <div class="form-group">
      <label for="sitesPassed" class="col-sm-3">Number of Sites Passed <span class="text-danger" ng-if="vm.randomized">*</span></label>
      <div class="col-sm-9">
        <input class="input-sm form-control" type="number" ng-model="vm.nonconformity.sitesPassed" id="sitesPassed" name="sitesPassed" ng-required="vm.randomized" ng-disabled="!vm.randomized && !vm.disableValidation"></input>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.sitesPassed.$touched) && vm.editForm.sitesPassed.$error.required">Field is required</div>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.sitesPassed.$touched) && vm.editForm.sitesPassed.$error.number">Must be a number</div>
      </div>
    </div>
    <div class="form-group">
      <label for="totalSites" class="col-sm-3">Total Sites <span class="text-danger" ng-if="vm.randomized">*</span></label>
      <div class="col-sm-9">
        <input class="input-sm form-control" type="number" ng-model="vm.nonconformity.totalSites" id="totalSites" name="totalSites" ng-required="vm.randomized" ng-disabled="!vm.randomized && !vm.disableValidation">
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.totalSites.$touched) && vm.editForm.totalSites.$error.required">Field is required</div>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.totalSites.$touched) && vm.editForm.totalSites.$error.number">Must be a number</div>
      </div>
    </div>
    <div class="form-group">
      <label for="summary" class="col-sm-3">Summary <span class="text-danger">*</span></label>
      <div class="col-sm-9">
        <input class="input-sm form-control" type="text" ng-model="vm.nonconformity.summary" id="summary" name="summary" required>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.summary.$touched) && vm.editForm.summary.$error.required">Field is required</div>
      </div>
    </div>
    <div class="form-group">
      <label for="findings" class="col-sm-3">Findings <span class="text-danger">*</span></label>
      <div class="col-sm-9">
        <textarea class="input-sm form-control" ng-model="vm.nonconformity.findings" id="findings" name="findings" required></textarea>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.findings.$touched) && vm.editForm.findings.$error.required">Field is required</div>
      </div>
    </div>
    <div class="form-group">
      <label for="developerExplanation" class="col-sm-3">Developer Explanation</label>
      <div class="col-sm-9">
        <textarea class="input-sm form-control" ng-model="vm.nonconformity.developerExplanation" id="developerExplanation" name="developerExplanation"></textarea>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.developerExplanation.$touched) && vm.editForm.developerExplanation.$error.required">Field is required</div>
      </div>
    </div>
    <div class="form-group">
      <label for="resolution" class="col-sm-3">Resolution <span class="text-danger" ng-if="vm.nonconformity.status.name === 'Closed'">*</span></label>
      <div class="col-sm-9">
        <textarea class="input-sm form-control" ng-model="vm.nonconformity.resolution" id="resolution" name="resolution" ng-required="vm.nonconformity.status.name === 'Closed'" ng-disabled="vm.nonconformity.status.name === 'Open'"></textarea>
        <div class="text-danger" ng-if="(vm.showFormErrors || vm.editForm.resolution.$touched) && vm.editForm.resolution.$error.required">Field is required</div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <div class="text-danger text-left" ng-if="vm.editForm.$invalid && vm.showFormErrors">
      The following error(s) must be fixed:
      <ul>
        <li ng-if="vm.editForm.nonconformityType.$error.required">Non-Conformity Type is required</li>
        <li ng-if="vm.editForm.nonconformityStatus.$error.required">Non-Conformity Status is required</li>
        <li ng-if="vm.editForm.dateOfDetermination.$error.required">Date of Determination is required</li>
        <li ng-if="vm.editForm.dateOfDetermination.$error.date">Date of Determination is an improper format (mm/dd/yyyy)</li>
        <li ng-if="vm.editForm.capApprovalDate.$error.required">Corrective Action Plan Approval Date is required</li>
        <li ng-if="vm.editForm.capApprovalDate.$error.date">Corrective Action Plan Approval Date is an improper format (mm/dd/yyyy)</li>
        <li ng-if="vm.editForm.capStartDate.$error.required">Corrective Action Plan Start Date is required</li>
        <li ng-if="vm.editForm.capStartDate.$error.date">Corrective Action Plan Start Date is an improper format (mm/dd/yyyy)</li>
        <li ng-if="vm.editForm.capEndDate.$error.required">Corrective Action Plan End Date is required</li>
        <li ng-if="vm.editForm.capEndDate.$error.date">Corrective Action Plan End Date is an improper format (mm/dd/yyyy)</li>
        <li ng-if="vm.editForm.capMustCompleteDate.$error.required">Corrective Action Plan Must Complete Date is required</li>
        <li ng-if="vm.editForm.capMustCompleteDate.$error.date">Corrective Action Plan Must Complete Date is an improper format (mm/dd/yyyy)</li>
        <li ng-if="vm.editForm.sitesPassed.$error.required">Number of sites passed is required</li>
        <li ng-if="vm.editForm.sitesPassed.$error.number">Number of sites passed must be a number</li>
        <li ng-if="vm.editForm.totalSites.$error.required">Total sites is required</li>
        <li ng-if="vm.editForm.totalSites.$error.number">Number of total sites must be a number</li>
        <li ng-if="vm.editForm.summary.$error.required">Summary is required</li>
        <li ng-if="vm.editForm.findings.$error.required">Findings is required</li>
        <li ng-if="vm.editForm.developerExplanation.$error.required">Developer Explanation is required</li>
        <li ng-if="vm.editForm.resolution.$error.required">Resolution is required</li>
      </ul>
    </div>
    <button ng-disabled="vm.editForm.$invalid && vm.showFormErrors && vm.disableValidation"
            class="btn btn-ai-success pull-right"
            ng-mouseover="vm.showFormErrors = true"
            ng-click="vm.save()"><i class="fa fa-save"></i> Save</button>
    <button class="btn btn-warning pull-left"
            confirm="Are you sure you wish to cancel editing? Your changes will not be saved."
            confirm-ok="Yes"
            confirm-cancel="No"
            confirm-settings="{animation: false, keyboard: false, backdrop: 'static'}"
            ng-click="vm.cancel()"><i class="fa fa-trash-o"></i> Cancel</button>
  </div>
</div>
